<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self-Audit & Fix - RankSmart</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <style>
        /* Mode 2 Specific Styles */
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .hero-section h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .hero-section p {
            font-size: 1.2rem;
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
        }

        .brain-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.9rem;
            margin-top: 1rem;
        }

        .input-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            margin-bottom: 2rem;
        }

        .url-input-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .url-input-group input {
            flex: 1;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .url-input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn-analyze {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-analyze:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .btn-analyze:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .progress-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            margin-bottom: 2rem;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .progress-step::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 50%;
            width: 100%;
            height: 2px;
            background: #e2e8f0;
            z-index: -1;
        }

        .progress-step:last-child::after {
            display: none;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e2e8f0;
            color: #94a3b8;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 0.5rem;
            transition: all 0.3s;
        }

        .progress-step.active .step-circle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            animation: pulse 2s infinite;
        }

        .progress-step.completed .step-circle {
            background: #10b981;
            color: white;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .results-section {
            display: none;
        }

        .score-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .score-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            text-align: center;
        }

        .score-card-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0.5rem 0;
        }

        .score-card-label {
            color: #64748b;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .score-improvement {
            color: #10b981;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .fixes-container {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            margin-bottom: 2rem;
        }

        .fixes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .fixes-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .fix-tab {
            padding: 0.75rem 1.5rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .fix-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .fix-item {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #e2e8f0;
            transition: all 0.3s;
        }

        .fix-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transform: translateX(4px);
        }

        .fix-item.priority-high {
            border-left-color: #ef4444;
        }

        .fix-item.priority-medium {
            border-left-color: #f59e0b;
        }

        .fix-item.priority-low {
            border-left-color: #10b981;
        }

        .fix-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .fix-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .fix-priority {
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .fix-priority.high {
            background: #fee2e2;
            color: #dc2626;
        }

        .fix-priority.medium {
            background: #fef3c7;
            color: #d97706;
        }

        .fix-priority.low {
            background: #d1fae5;
            color: #059669;
        }

        .fix-description {
            color: #64748b;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .fix-details {
            display: grid;
            gap: 1rem;
            margin-top: 1rem;
        }

        .fix-detail-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
        }

        .fix-detail-label {
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .fix-detail-content {
            color: #1e293b;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .fix-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .btn-apply {
            background: #10b981;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-apply:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn-skip {
            background: #f1f5f9;
            color: #64748b;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-skip:hover {
            background: #e2e8f0;
        }

        .bulk-actions {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-apply-all {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-apply-all:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(16, 185, 129, 0.3);
        }

        .export-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
        }

        .export-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .btn-export {
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-export:hover {
            border-color: #667eea;
            background: #f8fafc;
            transform: translateY(-2px);
        }

        .diff-viewer {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            margin-bottom: 2rem;
            display: none;
        }

        .diff-content {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
        }

        .diff-line-added {
            background: #d1fae5;
            color: #059669;
            padding: 0.25rem 0.5rem;
            display: block;
        }

        .diff-line-removed {
            background: #fee2e2;
            color: #dc2626;
            padding: 0.25rem 0.5rem;
            display: block;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #94a3b8;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 class="logo">üéØ RankSmart</h1>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-item">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="audit.html" class="nav-item">
                    <span class="nav-icon">üîç</span>
                    <span class="nav-text">SEO Audit</span>
                </a>
                <a href="competitor-mode.html" class="nav-item">
                    <span class="nav-icon">‚ú®</span>
                    <span class="nav-text">Content Generator</span>
                </a>
                <a href="self-audit.html" class="nav-item active">
                    <span class="nav-icon">üîß</span>
                    <span class="nav-text">Self-Audit & Fix</span>
                </a>
                <a href="serp-analysis.html" class="nav-item">
                    <span class="nav-icon">üéØ</span>
                    <span class="nav-text">SERP Analysis</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Hero Section -->
            <div class="hero-section">
                <h1>üîß Self-Audit & One-Click Fix</h1>
                <p>Analyze your content and apply AI-powered improvements with surgical precision</p>
                <div class="brain-badge">
                    <span>üß†</span>
                    <span>Powered by ChatGPT-5</span>
                </div>
            </div>

            <!-- Input Section -->
            <div class="input-card" id="input-section">
                <h2 style="margin-bottom: 1.5rem;">Enter Your Content URL</h2>
                <div class="url-input-group">
                    <input 
                        type="url" 
                        id="content-url" 
                        placeholder="https://yoursite.com/article"
                        onkeypress="if(event.key === 'Enter') startAnalysis()"
                    >
                    <button class="btn-analyze" onclick="startAnalysis()" id="analyze-btn">
                        <span id="analyze-text">üîç Analyze Content</span>
                        <span id="analyze-spinner" class="spinner" style="display: none;"></span>
                    </button>
                </div>
                <p style="color: #64748b; font-size: 0.9rem;">
                    üí° Enter your article URL and we'll analyze it with ChatGPT-5 to find actionable improvements
                </p>
            </div>

            <!-- Progress Section -->
            <div class="progress-section" id="progress-section" style="display: none;">
                <h2 style="margin-bottom: 1.5rem;">Analyzing Your Content...</h2>
                <div class="progress-steps">
                    <div class="progress-step" id="step-1">
                        <div class="step-circle">1</div>
                        <div>Scraping Content</div>
                    </div>
                    <div class="progress-step" id="step-2">
                        <div class="step-circle">2</div>
                        <div>SERP Analysis</div>
                    </div>
                    <div class="progress-step" id="step-3">
                        <div class="step-circle">3</div>
                        <div>ChatGPT-5 Analysis</div>
                    </div>
                    <div class="progress-step" id="step-4">
                        <div class="step-circle">4</div>
                        <div>Generating Fixes</div>
                    </div>
                </div>
                <p id="progress-message" style="text-align: center; color: #64748b;">
                    Starting analysis...
                </p>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="results-section">
                <!-- Score Cards -->
                <div class="score-cards">
                    <div class="score-card">
                        <div class="score-card-label">Current Score</div>
                        <div class="score-card-value" id="current-score">--</div>
                    </div>
                    <div class="score-card">
                        <div class="score-card-label">Potential Score</div>
                        <div class="score-card-value" id="potential-score">--</div>
                    </div>
                    <div class="score-card">
                        <div class="score-card-label">Improvement</div>
                        <div class="score-improvement" id="score-improvement">+--</div>
                    </div>
                    <div class="score-card">
                        <div class="score-card-label">Total Fixes</div>
                        <div class="score-card-value" id="total-fixes">--</div>
                    </div>
                </div>

                <!-- Bulk Actions -->
                <div class="bulk-actions">
                    <div>
                        <h3 style="margin-bottom: 0.5rem;">Ready to Improve?</h3>
                        <p style="color: #64748b; margin: 0;">Apply all fixes with one click</p>
                    </div>
                    <button class="btn-apply-all" onclick="applyAllFixes()">
                        <span id="apply-all-text">‚ú® Apply All Fixes</span>
                        <span id="apply-all-spinner" class="spinner" style="display: none;"></span>
                    </button>
                </div>

                <!-- Fixes Container -->
                <div class="fixes-container">
                    <div class="fixes-header">
                        <h2>Actionable Fixes</h2>
                        <button class="btn-export" onclick="toggleDiffViewer()">
                            üìä View Diff
                        </button>
                    </div>

                    <!-- Fixes Tabs -->
                    <div class="fixes-tabs">
                        <button class="fix-tab active" onclick="filterFixes('all')" id="tab-all">
                            All Fixes (<span id="count-all">0</span>)
                        </button>
                        <button class="fix-tab" onclick="filterFixes('high')" id="tab-high">
                            üî¥ High Priority (<span id="count-high">0</span>)
                        </button>
                        <button class="fix-tab" onclick="filterFixes('medium')" id="tab-medium">
                            üü° Medium (<span id="count-medium">0</span>)
                        </button>
                        <button class="fix-tab" onclick="filterFixes('low')" id="tab-low">
                            üü¢ Low (<span id="count-low">0</span>)
                        </button>
                    </div>

                    <!-- Fixes List -->
                    <div id="fixes-list">
                        <!-- Fixes will be dynamically inserted here -->
                    </div>
                </div>

                <!-- Diff Viewer -->
                <div class="diff-viewer" id="diff-viewer">
                    <h2 style="margin-bottom: 1.5rem;">Content Changes</h2>
                    <div class="diff-content" id="diff-content">
                        <!-- Diff will be shown here -->
                    </div>
                </div>

                <!-- Export Section -->
                <div class="export-section">
                    <h2 style="margin-bottom: 1.5rem;">Export Improved Content</h2>
                    <div class="export-buttons">
                        <button class="btn-export" onclick="exportContent('copy')">
                            üìã Copy to Clipboard
                        </button>
                        <button class="btn-export" onclick="exportContent('html')">
                            üìÑ Download HTML
                        </button>
                        <button class="btn-export" onclick="exportContent('markdown')">
                            üìù Download Markdown
                        </button>
                        <button class="btn-export" onclick="exportContent('wordpress')">
                            üì∞ Export to WordPress
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Global state
        let analysisData = null;
        let improvedContent = null;
        let currentFilter = 'all';

        // Start analysis
        async function startAnalysis() {
            const url = document.getElementById('content-url').value.trim();
            
            if (!url) {
                alert('Please enter a URL');
                return;
            }

            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                alert('Please enter a valid URL starting with http:// or https://');
                return;
            }

            // Show progress
            document.getElementById('input-section').style.display = 'none';
            document.getElementById('progress-section').style.display = 'block';
            document.getElementById('analyze-btn').disabled = true;

            try {
                // Step 1: Scrape content
                updateProgress(1, 'Scraping content from URL...');
                const scrapeResponse = await fetch('/api/audit/firecrawl', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });

                if (!scrapeResponse.ok) {
                    throw new Error('Failed to scrape content');
                }

                const scrapeData = await scrapeResponse.json();
                const content = scrapeData.markdown || scrapeData.content;

                // Step 2: SERP Analysis (optional, for competitor comparison)
                updateProgress(2, 'Analyzing competitors...');
                let serpData = null;
                // Skip SERP for now, can be added later

                // Step 3: Self-audit with ChatGPT-5
                updateProgress(3, 'ChatGPT-5 is analyzing your content...');
                const auditResponse = await fetch('/api/audit/self-scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        url,
                        content,
                        serpData
                    })
                });

                if (!auditResponse.ok) {
                    throw new Error('Analysis failed');
                }

                analysisData = await auditResponse.json();

                // Step 4: Complete
                updateProgress(4, 'Analysis complete!');
                
                setTimeout(() => {
                    displayResults();
                }, 1000);

            } catch (error) {
                console.error('Analysis error:', error);
                alert('Analysis failed: ' + error.message);
                document.getElementById('input-section').style.display = 'block';
                document.getElementById('progress-section').style.display = 'none';
                document.getElementById('analyze-btn').disabled = false;
            }
        }

        // Update progress
        function updateProgress(step, message) {
            // Mark previous steps as completed
            for (let i = 1; i < step; i++) {
                document.getElementById(`step-${i}`).classList.add('completed');
                document.getElementById(`step-${i}`).classList.remove('active');
            }
            
            // Mark current step as active
            document.getElementById(`step-${step}`).classList.add('active');
            document.getElementById('progress-message').textContent = message;
        }

        // Display results
        function displayResults() {
            document.getElementById('progress-section').style.display = 'none';
            document.getElementById('results-section').style.display = 'block';

            const data = analysisData.data;

            // Update score cards
            document.getElementById('current-score').textContent = data.current.score;
            document.getElementById('potential-score').textContent = data.analysis.estimatedScoreAfterFixes;
            document.getElementById('score-improvement').textContent = '+' + data.analysis.potentialIncrease;
            
            const totalFixes = data.fixes.high.length + data.fixes.medium.length + data.fixes.low.length;
            document.getElementById('total-fixes').textContent = totalFixes;

            // Update counts
            document.getElementById('count-all').textContent = totalFixes;
            document.getElementById('count-high').textContent = data.fixes.high.length;
            document.getElementById('count-medium').textContent = data.fixes.medium.length;
            document.getElementById('count-low').textContent = data.fixes.low.length;

            // Display fixes
            displayFixes();
        }

        // Display fixes
        function displayFixes() {
            const data = analysisData.data;
            const fixesList = document.getElementById('fixes-list');
            fixesList.innerHTML = '';

            let allFixes = [];
            
            if (currentFilter === 'all' || currentFilter === 'high') {
                allFixes = allFixes.concat(data.fixes.high.map(f => ({...f, priority: 'high'})));
            }
            if (currentFilter === 'all' || currentFilter === 'medium') {
                allFixes = allFixes.concat(data.fixes.medium.map(f => ({...f, priority: 'medium'})));
            }
            if (currentFilter === 'all' || currentFilter === 'low') {
                allFixes = allFixes.concat(data.fixes.low.map(f => ({...f, priority: 'low'})));
            }

            if (allFixes.length === 0) {
                fixesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üéâ</div>
                        <h3>No ${currentFilter === 'all' ? '' : currentFilter + ' priority'} fixes needed!</h3>
                        <p>Your content is looking great.</p>
                    </div>
                `;
                return;
            }

            allFixes.forEach((fix, index) => {
                const fixHtml = `
                    <div class="fix-item priority-${fix.priority}">
                        <div class="fix-header">
                            <div>
                                <div class="fix-title">${fix.title}</div>
                                <div class="fix-description">${fix.description}</div>
                            </div>
                            <span class="fix-priority ${fix.priority}">${fix.impact}</span>
                        </div>
                        <div class="fix-details">
                            ${fix.location ? `
                                <div class="fix-detail-item">
                                    <div class="fix-detail-label">üìç Location</div>
                                    <div class="fix-detail-content">${fix.location}</div>
                                </div>
                            ` : ''}
                            ${fix.suggestion ? `
                                <div class="fix-detail-item">
                                    <div class="fix-detail-label">üí° Suggestion</div>
                                    <div class="fix-detail-content">${fix.suggestion}</div>
                                </div>
                            ` : ''}
                            ${fix.reasoning ? `
                                <div class="fix-detail-item">
                                    <div class="fix-detail-label">üéØ Why This Matters</div>
                                    <div class="fix-detail-content">${fix.reasoning}</div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="fix-actions">
                            <button class="btn-apply" onclick="applyFix(${index})">
                                ‚úÖ Apply This Fix
                            </button>
                            <button class="btn-skip" onclick="skipFix(${index})">
                                Skip
                            </button>
                        </div>
                    </div>
                `;
                fixesList.innerHTML += fixHtml;
            });
        }

        // Filter fixes
        function filterFixes(filter) {
            currentFilter = filter;
            
            // Update active tab
            document.querySelectorAll('.fix-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`tab-${filter}`).classList.add('active');
            
            displayFixes();
        }

        // Apply all fixes
        async function applyAllFixes() {
            const btn = document.getElementById('apply-all-text');
            const spinner = document.getElementById('apply-all-spinner');
            
            btn.style.display = 'none';
            spinner.style.display = 'inline-block';

            try {
                const data = analysisData.data;
                const allFixes = [...data.fixes.high, ...data.fixes.medium, ...data.fixes.low];

                const response = await fetch('/api/audit/apply-fixes', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        originalContent: data.current.content || '',
                        fixes: allFixes,
                        preserveVoice: true
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to apply fixes');
                }

                const result = await response.json();
                improvedContent = result.data.improvedContent;

                alert('‚úÖ All fixes applied successfully!');
                
                // Update score
                document.getElementById('current-score').textContent = result.data.metrics.improved.estimatedScore;
                document.getElementById('score-improvement').textContent = '+' + result.data.metrics.improvements.scoreIncrease;

            } catch (error) {
                console.error('Apply fixes error:', error);
                alert('Failed to apply fixes: ' + error.message);
            } finally {
                btn.style.display = 'inline';
                spinner.style.display = 'none';
            }
        }

        // Apply single fix
        function applyFix(index) {
            alert('Applying fix #' + (index + 1));
            // Implementation for single fix
        }

        // Skip fix
        function skipFix(index) {
            alert('Skipped fix #' + (index + 1));
        }

        // Toggle diff viewer
        function toggleDiffViewer() {
            const viewer = document.getElementById('diff-viewer');
            viewer.style.display = viewer.style.display === 'none' ? 'block' : 'none';
        }

        // Export content
        function exportContent(format) {
            if (!improvedContent) {
                alert('Please apply fixes first');
                return;
            }

            switch(format) {
                case 'copy':
                    navigator.clipboard.writeText(improvedContent);
                    alert('‚úÖ Copied to clipboard!');
                    break;
                case 'html':
                    downloadFile(improvedContent, 'improved-content.html', 'text/html');
                    break;
                case 'markdown':
                    downloadFile(improvedContent, 'improved-content.md', 'text/markdown');
                    break;
                case 'wordpress':
                    alert('WordPress export coming soon!');
                    break;
            }
        }

        // Download file helper
        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
